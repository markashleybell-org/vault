@model dynamic

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/Main.cshtml";
}

@section main {

    <div class="row" id="controls">
        <div class="col-md-8" class="relative-container">
            <label class="sr-only" for="search">Search</label>
            <input type="text" id="search" name="search" class="form-control" placeholder="Search..." />
            <button id="clear-search" class="btn btn-link">
                <span class="glyphicon glyphicon-remove"></span>
            </button>
        </div>
        <div class="col-md-2">
            <label class="sr-only" for="new">New Item</label>
            <button id="new" class="btn btn-primary btn-block">
                <span class="glyphicon glyphicon-plus"></span> New
            </button>
        </div>
        <div class="col-md-2">
            <label class="sr-only" for="admin">Admin</label>
            <button id="admin" class="btn btn-default btn-block">
                <span class="glyphicon glyphicon-cog"></span> Admin
            </button>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12" id="container"></div>
    </div>

    @{Html.RenderPartial("Credential", new CredentialViewModel());}

    @{Html.RenderPartial("Login", new LoginViewModel());}

    <div id="modal-lg" class="modal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" id="modal-lg-content"></div>
        </div>
    </div>

    <div id="modal-sm" class="modal">
        <div class="modal-dialog modal-sm">
            <div class="modal-content" id="modal-sm-content"></div>
        </div>
    </div>

    <script id="tmpl-modalheader" type="text/x-handlebars-template">
        <div class="modal-header">
            {{#if showclose}}
            <button type="button" class="close btn-close"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            {{/if}}
            <h4 class="modal-title">{{title}}</h4>
        </div>
    </script>

    <script id="tmpl-modalbody" type="text/x-handlebars-template">
        <div class="modal-body">
            {{{content}}}
        </div>
    </script>

    <script id="tmpl-modalfooter" type="text/x-handlebars-template">
        <div class="modal-footer">
            {{#if showclose}}
            <button type="button" class="btn btn-default btn-close">Close</button>
            {{/if}}
            <button type="submit" class="btn btn-primary btn-action">{{button}}</button>
        </div>
    </script>

    <script id="tmpl-copylink" type="text/x-handlebars-template">
        <span class="copy-link">
            <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="14" height="14">
               <param name="movie" value="/content/img/clippy.swf" />
               <param name="allowScriptAccess" value="always" />
               <param name="quality" value="high" />
               <param name="scale" value="noscale" />
               <param name="FlashVars" value="text={{text}}">
               <param name="bgcolor" value="#ffffff">
               <param name="wmode" value="opaque">
               <embed src="/content/img/clippy.swf"
                      width="14"
                      height="14"
                      wmode="opaque"
                      name="clippy"
                      quality="high"
                      scale="noscale"
                      allowscriptaccess="always"
                      type="application/x-shockwave-flash"
                      pluginspage="http://www.macromedia.com/go/getflashplayer"
                      flashvars="text={{text}}"
                      bgcolor="#ffffff" />
            </object>
        </span>
    </script>
    
    <script id="tmpl-detail" type="text/x-handlebars-template">
        <table class="table detail">
            <colgroup>
                <col class="detail-label" />
                <col class="detail-copylink" />
                <col class="detail-data" />
            </colgroup>
            <tbody>    
                {{#if Url}}
                <tr>
                    <th>Url</th>
                    <td>&nbsp;</td>
                    <td><a class="display-link" href="{{Url}}" onclick="window.open(this.href); return false;">{{Url}}</a></td>
                </tr>
                {{/if}}
                {{#if Username}}
                <tr>
                    <th>Username</th>
                    <td>{{{UsernameCopyLink}}}</td>
                    <td>{{Username}}</td>
                </tr>
                {{/if}}
                {{#if Password}}
                <tr>
                    <th>Password</th>
                    <td>{{{PasswordCopyLink}}}</td>
                    <td>{{Password}}</td>
                </tr>
                {{/if}}
                {{#if UserDefined1}}
                <tr>
                    <th>{{UserDefined1Label}}</th>
                    <td>{{{UserDefined1CopyLink}}}</td>
                    <td>{{UserDefined1}}</td>
                </tr>
                {{/if}}
                {{#if UserDefined2}}
                <tr>
                    <th>{{UserDefined2Label}}</th>
                    <td>{{{UserDefined2CopyLink}}}</td>
                    <td>{{UserDefined2}}</td>
                </tr>
                {{/if}}
                {{#if Notes}}
                <tr>
                    <th>Notes</th>
                    <td>&nbsp;</td>
                    <td>{{breaklines Notes}}</td>
                </tr>
                {{/if}}
            </tbody>
        </table>
    </script>

    <script id="tmpl-deleteconfirmationdialog" type="text/x-handlebars-template">
        <p>Are you sure you want to delete this credential?</p>
    </script>

    <script id="tmpl-optionsdialog" type="text/x-handlebars-template">
        <p>Enter and confirm a new password:</p>
        <div class="form-horizontal">
            <div class="form-group">
                <label for="NewPassword" class="col-sm-4 control-label">New Password</label>
                <div class="col-sm-8">
                    <input type="password" id="NewPassword" name="NewPassword" class="form-control" value="" />
                </div>
            </div>
            <div class="form-group">
                <label for="NewPasswordConfirm" class="col-sm-4 control-label">Confirm New Password</label>
                <div class="col-sm-8">
                    <input type="password" id="NewPasswordConfirm" name="NewPasswordConfirm" class="form-control" value="" />
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-4 col-sm-8">
                    <button class="btn btn-warning" id="change-password-button" onclick="Vault.changePassword('{{userid}}', '{{masterkey}}');">Change Password</button>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-4 col-sm-8">
                    <button class="btn btn-default" id="export-button" onclick="Vault.exportData('{{userid}}', '{{masterkey}}');">Export Data</button>
                </div>
            </div>
        </div>
    </script>

    <script id="tmpl-exporteddatawindow" type="text/x-handlebars-template">
        <html><head><title>Exported Data</title></head><body style="margin: 0; padding: 0;"><textarea style="border: none; width: 100%; height: 600px;">{{json}}</textarea></body></html>
    </script>

    <script id="tmpl-validationmessage" type="text/x-handlebars-template">
        <div id="validation-message"><p>{{{errors}}}</p></div>
    </script>

    <script id="tmpl-credentialtable" type="text/x-handlebars-template">
        <table id="records" class="table table-condensed">
            <tbody>
                {{#each rows}}
                {{> credentialtablerow}}
                {{/each}}
            </tbody>
        </table>
    </script>

    <script id="tmpl-credentialtablerow" type="text/x-handlebars-template">
        <tr id="{{credentialid}}">
            <td>
                <button class="btn btn-default btn-block btn-l" onclick="Vault.showDetail('{{credentialid}}', '{{masterkey}}');">{{description}}</button>
            </td>
            <td class="center">
                <button class="btn btn-primary btn-block" onclick="Vault.loadCredential('{{credentialid}}', '{{masterkey}}', '{{userid}}');">
                    <span class="glyphicon glyphicon-pencil"></span>
                </button>
            </td>
            <td class="center">
                <button class="btn btn-danger btn-block" onclick="Vault.confirmDelete('{{credentialid}}', '{{userid}}');">
                    <span class="glyphicon glyphicon-trash"></span>
                </button>
            </td>
        </tr>
    </script>
}

@section foot {

    <script type="text/javascript">
        var loginDialog = $('#login-form-dialog');
        loginDialog.modal();
        loginDialog.find('input[name="Username"]').focus();

        $(function () {
            Vault.init();
        });
    </script>

}